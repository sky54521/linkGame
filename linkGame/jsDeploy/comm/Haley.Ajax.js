if(!Haley){var Haley={}}Haley.Ajax=function(){this.construct.apply(this,arguments)};Haley.Ajax.prototype={construct:function(a){this.xmlhttp=this.getXmlHttpObject();this.options=a||{};this.headers=this.options.headers||{};this.method=(this.options.method||"get").toLowerCase();this.async=this.options.async||true;this.url=this.options.url||null;this.postdata=this.options.postdata||"";this.timeout=null;if(this.method=="post"){this.headers["Content-Type"]="application/x-www-form-urlencoded"}},start:function(){var a=this;var b=typeof(this.options.parameters)=="string"?this.options.parameters:this.encodeParameters(this.options.parameters||{});if(b&&this.method=="get"){this.url+=(this.url.indexOf("?")>-1?"&":"?")+b}this.xmlhttp.open(this.method,this.url,this.async);this.onLoading();for(header in this.headers){this.xmlhttp.setRequestHeader(header,this.headers[header])}this.xmlhttp.onreadystatechange=function(){a.dispatchEvent()};if(this.options.timeout&&typeof(this.options.timeout)=="number"){this.timeout=setTimeout(function(){a.onAbort();a.onLoaded();a.onTimeout()},this.options.timeout*1000)}this.xmlhttp.send(this.method=="post"?(this.postdata||b):null);if(!this.async){this.dispatchEvent()}},getXmlHttpObject:function(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{if(window.ActiveXObject){var d=new Array("Msxml2.XMLHTTP","Microsoft.XMLHTTP");for(var b=0,a=d.length;b<a;b++){try{return new ActiveXObject(d[b])}catch(c){}}}}throw new Error("Could not instantiate XmlHttpObject!")},encodeParameters:function(b){var a=[];for(parameter in b){a.push(encodeURIComponent(parameter)+"="+encodeURIComponent(b[parameter]))}return a.join("&")},addRequestHeader:function(a,b){this.headers[a]=b},onTimeout:function(){},onLoading:function(){},onLoaded:function(){},onComplete:function(a){},onError:function(a){},onAbort:function(){if(this.xmlhttp){this.xmlhttp.abort()}},dispatchEvent:function(){if(this.xmlhttp.readyState==4){if(this.timeout){clearTimeout(this.timeout)}this.onLoaded();if(this.xmlhttp.status==200){this.onComplete({textString:this.xmlhttp.responseText,xmlDocument:this.xmlhttp.responseXML})}else{if(this.xmlhttp.status==0){this.onAbort()}else{this.onError({url:this.url,status:this.xmlhttp.status,statusText:this.xmlhttp.statusText,responseText:this.xmlhttp.responseText})}}}}};