var $kyodai={mapX:19,mapY:11,mapLength:14};$kyodai.cross=function(a,f){for(var c=a-1;c>-1;c--){if($kyodai.block[c+","+f]){break}}for(var b=a+1;b<$kyodai.mapX;b++){if($kyodai.block[b+","+f]){break}}for(var e=f-1;e>-1;e--){if($kyodai.block[a+","+e]){break}}for(var d=f+1;d<$kyodai.mapY;d++){if($kyodai.block[a+","+d]){break}}return{x1:c,x2:b,y1:e,y2:d}};$kyodai.passx=function(b,a,c){if(b<a){while(++b<a){if($kyodai.block[b+","+c]){return false}}}else{while(++a<b){if($kyodai.block[a+","+c]){return false}}}return true};$kyodai.passy=function(c,b,a){if(c<b){while(++c<b){if($kyodai.block[a+","+c]){return false}}}else{while(++b<c){if($kyodai.block[a+","+b]){return false}}}return true};$kyodai.linex=function(b,a,d){var c=[];if(b<a){while(b++<a){c.push('<img src="images/linex.gif" style="position:absolute;left:'+(b*31-16)+"px;top:"+d*35+'px">')}}else{while(a++<b){c.push('<img src="images/linex.gif" style="position:absolute;left:'+(a*31-16)+"px;top:"+d*35+'px">')}}return c};$kyodai.liney=function(c,b,a){var d=[];if(c<b){while(c++<b){d.push('<img src="images/liney.gif" style="position:absolute;left:'+a*31+"px;top:"+(c*35-18)+'px">')}}else{while(b++<c){d.push('<img src="images/liney.gif" style="position:absolute;left:'+a*31+"px;top:"+(b*35-18)+'px">')}}return d};$kyodai.find=function(o,n,v,t){var m=$kyodai.cross(o,n);if(n==t&&m.x1<v&&v<m.x2){return $kyodai.linex(o,v,n)}if(o==v&&m.y1<t&&t<m.y2){return $kyodai.liney(n,t,o)}var w=$kyodai.cross(v,t);var u=m.x1<w.x1?w.x1:m.x1;var r=m.x2>w.x2?w.x2:m.x2;var g=m.y1<w.y1?w.y1:m.y1;var f=m.y2>w.y2?w.y2:m.y2;if(u<o&&o<r&&g<t&&t<f){return $kyodai.liney(n,t,o).concat($kyodai.linex(o,v,t))}if(u<v&&v<r&&g<n&&n<f){return $kyodai.liney(n,t,v).concat($kyodai.linex(o,v,n))}if(o<v){var q=o;var p=v;var c=n;var j=t}else{var q=v;var p=o;var c=t;var j=n}for(var l=q+1;l<p;l++){if(u<l&&l<r&&$kyodai.passy(c,j,l)){return $kyodai.liney(c,j,l).concat($kyodai.linex(q,l,c),$kyodai.linex(l,p,j))}}if(n<t){var d=n;var b=t;var a=o;var h=v}else{var d=t;var b=n;var a=v;var h=o}for(var k=d+1;k<b;k++){if(g<k&&k<f&&$kyodai.passx(a,h,k)){return $kyodai.linex(a,h,k).concat($kyodai.liney(d,k,a),$kyodai.liney(k,b,h))}}c=true;j=true;a=true;h=true;while(c||j||a||h){if(c){if(u<--q&&q<r){if($kyodai.passy(n,t,q)){return $kyodai.liney(n,t,q).concat($kyodai.linex(q,o,n),$kyodai.linex(q,v,t))}}else{c=false}}if(j){if(u<++p&&p<r){if($kyodai.passy(n,t,p)){return $kyodai.liney(n,t,p).concat($kyodai.linex(p,o,n),$kyodai.linex(p,v,t))}}else{j=false}}if(a){if(g<--d&&d<f){if($kyodai.passx(o,v,d)){return $kyodai.linex(o,v,d).concat($kyodai.liney(d,n,o),$kyodai.liney(d,t,v))}}else{a=false}}if(h){if(g<++b&&b<f){if($kyodai.passx(o,v,b)){return $kyodai.linex(o,v,b).concat($kyodai.liney(b,n,o),$kyodai.liney(b,t,v))}}else{h=false}}}return false};var _getMapByUrl=function(){var c="map/"+Math.floor(Math.random()*$kyodai.mapLength)+".xml";var b=new ActiveXObject("Microsoft.XMLDOM");b.async=false;b.load(c);var a=b.selectSingleNode("map").text.split("\n");a.shift();return a};var _getMapFromServer=function(){var a=["-1-1-1-1-1-1-1-1-1-","1-1-1-1-1-1-1-1-1-1","-1-1-1-1-1-1-1-1-1-","1-1-1-1-1-1-1-1-1-1","-1-1-1-1-1-1-1-1-1-","1-1-1-1-1-1-1-1-1-1","-1-1-1-1-1-1-1-1-1-","1-1-1-1-1-1-1-1-1-1","-1-1-1-1-1-1-1-1-1-","1-1-1-1-1-1-1-1-1-1","-1-1-1-1-1-1-1-1-1-"];return a};$kyodai.loadmap=function(){$kyodai.block={};$kyodai.shape=[];var a=_getMapByUrl();for(var k=0;k<a.length;k++){for(var h=0;h<a[0].length;h++){if(a[k].charAt(h)=="1"){$kyodai.shape.push({x:h,y:k})}}}var g=[];var f=$kyodai.random([1,2,3,4,5,6,7,8]);var b=2;var e=$kyodai.shape.length;for(var d=0;d<5;d++){if(g.length==8){b=1}if(g.length==10){break}for(var c=Math.floor(Math.random()*b)*2+2;c>0;c--){g.push(f[d])}}for(b=9;b<42;b++){if(e-g.length<3){if(e==g.length){break}else{g.push(b);g.push(b);break}}g.push(b);g.push(b);g.push(b);g.push(b)}kyodai_remain.innerText=e;$kyodai.remain=e;$kyodai.setting(g);$kyodai.count()};$kyodai.setting=function(a){var b=[];$kyodai.shape=$kyodai.random($kyodai.shape);for(i=0;i<$kyodai.shape.length;i++){var c=a[i];x=$kyodai.shape[i].x;y=$kyodai.shape[i].y;$kyodai.block[x+","+y]=c;if(c){b.push("<img id=Item_"+x+"_"+y+' src="images/'+c+'.gif" style="z-index:'+(100-x+y)+";position:absolute;left:"+x*31+"px;top:"+y*35+'px">')}}kyodai_items.innerHTML=b.join("")};$kyodai.choose=function(a,b){kyodai_cuechoose.innerText="";$kyodai.point={x:a,y:b};kyodai_choose.style.pixelLeft=a*31+4;kyodai_choose.style.pixelTop=b*35};$kyodai.cancel=function(){kyodai_cuechoose.innerText="";$kyodai.point=false;kyodai_choose.style.pixelLeft=-2000};$kyodai.click=function(){var d=Math.floor((event.x-16)/31);var c=Math.floor((event.y-182)/35);if(!$kyodai.block[d+","+c]){return}$kyodai.sound(2);if(!$kyodai.point){$kyodai.choose(d,c);return}var g=$kyodai.point.x;var f=$kyodai.point.y;var j=g+","+f;var b=d+","+c;if(j==b){$kyodai.cancel();return}var k=$kyodai.block[j];var a=$kyodai.block[b];if(k!=a){$kyodai.choose(d,c);return}$kyodai.cancel();$kyodai.block[j]=0;$kyodai.block[b]=0;var h=$kyodai.find(g,f,d,c);if(!h){$kyodai.block[j]=k;$kyodai.block[b]=a;return}if(a<4){$kyodai.add(a)}kyodai_lines.innerHTML=h.join("");$kyodai.del(g,f,d,c)};$kyodai.del=function(d,c,b,a){sendClickData({sx:d,sy:c,ex:b,ey:a});$kyodai.sound(3);$kyodai.count();$kyodai.remain-=2;kyodai_remain.innerText=$kyodai.remain;document.getElementById("Item_"+d+"_"+c).removeNode();document.getElementById("Item_"+b+"_"+a).removeNode();kyodai_del_1.style.pixelLeft=d*31-15;kyodai_del_1.style.pixelTop=c*35-15;kyodai_del_2.style.pixelLeft=b*31-15;kyodai_del_2.style.pixelTop=a*35-15;kyodai_del_1.src="images/del.gif";kyodai_del_2.src="images/del.gif";if(!$kyodai.remain){setTimeout("$kyodai.over('win')",600);sendEndData("win")}};$kyodai.count=function(){clearInterval($kyodai.timeid);kyodai_count.src="images/count1.gif";kyodai_count.style.pixelWidth=330;$kyodai.timeid=setInterval(function(){var a=kyodai_count.style.pixelWidth;kyodai_count.style.pixelWidth=a-1;switch(a){case 270:kyodai_count.src="images/count2.gif";break;case 180:kyodai_count.src="images/count3.gif";break;case 100:kyodai_count.src="images/count4.gif";break;case 65:kyodai_count.src="images/count5.gif";break;case 30:kyodai_count.src="images/count6.gif"}if(a<2){$kyodai.over("timeover");sendEndData("timeover")}},80)};$kyodai.random=function(a){var b=[];while(a.length){b=b.splice(0,Math.floor(Math.random()*(b.length+1))).concat(a.splice(Math.floor(Math.random()*a.length),1),b)}return b};$kyodai.add=function(a){if($kyodai.pptnum[a]){document.getElementById("kyodai_ppt_"+a+"_num").src="images/ppt_num_"+ ++$kyodai.pptnum[a]+".gif"}else{$kyodai.pptnum[a]=1;kyodai_ppt.insertAdjacentHTML("beforeEnd","<img id=kyodai_ppt_"+a+' src="images/ppt_'+a+'.gif">');kyodai_ppt_num.insertAdjacentHTML("beforeEnd","<img id=kyodai_ppt_"+a+'_num src="images/ppt_num_1.gif" onclick="$kyodai.use('+a+')">')}};$kyodai.use=function(a){$kyodai.sound(4);$kyodai.cancel();if(--$kyodai.pptnum[a]){document.getElementById("kyodai_ppt_"+a+"_num").src="images/ppt_num_"+$kyodai.pptnum[a]+".gif"}else{document.getElementById("kyodai_ppt_"+a).removeNode();document.getElementById("kyodai_ppt_"+a+"_num").removeNode()}switch(a){case 1:$kyodai.cue(false);break;case 2:$kyodai.reset();break;case 3:$kyodai.cue(true)}};$kyodai.cue=function(e){var l=$kyodai.shape;var a=$kyodai.pptnum[1];for(var c=0;c<l.length;c++){a=$kyodai.block[l[c].x+","+l[c].y];if(a){for(var b=c+1;b<l.length;b++){if(a==$kyodai.block[l[b].x+","+l[b].y]){var h=l[c].x;var g=l[c].y;var f=l[b].x;var d=l[b].y;var k=$kyodai.find(h,g,f,d);if(k){kyodai_cuechoose.innerHTML='<img src = "images/choose.gif" onmouseup="$kyodai.click('+h+","+g+')" style="position:absolute;left:'+(h*31+4)+"px;top:"+g*35+'px"><img src = "images/choose.gif" onmouseup="$kyodai.click('+f+","+d+')" style="position:absolute;left:'+(f*31+4)+"px;top:"+d*35+'px">';kyodai_lines.innerHTML=k.join("");if(e){kyodai_cuechoose.innerText="";$kyodai.block[h+","+g]=0;$kyodai.block[f+","+d]=0;$kyodai.del(h,g,f,d)}return}}}}}};$kyodai.reset=function(){var b=[];for(var a in $kyodai.block){b.push($kyodai.block[a])}$kyodai.setting(b)};$kyodai.sound=function(b){try{au_sound.GotoFrame(0);au_sound.GotoFrame(b);au_sound.Play()}catch(a){}};$kyodai.over=function(a){$kyodai.cancel();clearInterval($kyodai.timeid);kyodai_count.style.pixelWidth=0;kyodai_center.src="images/"+a+".gif";kyodai_center.style.display="";kyodai_items.innerText="";kyodai_ppt_num.innerText="";kyodai_ppt.innerHTML='<img src="images/ppt.gif">';document.onkeydown=null};$kyodai.start=function(){sendStartData();kyodai_center.style.display="none";$kyodai.sound(1);$kyodai.cancel();$kyodai.pptnum={1:3,2:3};kyodai_ppt.innerHTML='<img id=kyodai_ppt_1 src="images/ppt_1.gif"><img id=kyodai_ppt_2 src="images/ppt_2.gif">';kyodai_ppt_num.innerHTML='<img id=kyodai_ppt_1_num src="images/ppt_num_3.gif" onmouseup="$kyodai.use(1)"><img id=kyodai_ppt_2_num src="images/ppt_num_3.gif" onmouseup="$kyodai.use(2)">';document.onkeydown=function(){if(event.keyCode==49&&$kyodai.pptnum[1]){$kyodai.use(1)}if(event.d==50&&$kyodai.pptnum[2]){$kyodai.use(2)}};$kyodai.loadmap()};var sendStartData=function(b){var a={data:new Date(),url:"url"};_sendAjax(a)};var sendClickData=function(b){var a={data:b,url:"url"};_sendAjax(a)};var sendEndData=function(b){var a={data:b,url:"url"};_sendAjax(a)};var _sendAjax=function(a){alert(JSON.stringify(a.data));a.parameters={};a.parameters.queryTypeStr=encodeURI(JSON.stringify(a.data));var b=new Haley.Ajax(a);b.onLoading=function(){};b.onComplete=function(d){var c=d.textString;var e=$.parseJSON(c)}};